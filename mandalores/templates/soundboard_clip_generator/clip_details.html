{% extends "base.html" %}

{% block title %}Soundboard Clip Generator - Mandalores {% endblock %}

{% block page_title %}Soundboard Clip Generator{% endblock %}

{% block content %}
    <p>Status: <span id="clip-status">{{ clip.get_status_display }}</span></p>
    <div id="download-container">
        {% if clip.status == 'completed' %}
            <a id="download-link" href="{% url 'home' %}">Download Clip</a>
        {% endif %}
    </div>

<script>
    function checkStatus() {
        fetch("{% url 'soundboard:clip_with_id' clip.id %}")
            .then(response => response.json())
            .then(data => {
                document.getElementById('clip-status').innerText = data.status;
                if (data.status === 'completed') {
                    clearInterval(statusInterval);
                    const downloadContainer = document.getElementById('download-container');
                    const downloadLink = document.createElement('a');
                    downloadLink.id = 'download-link';
                    downloadLink.href = '{% url "home" %}';
                    downloadLink.innerText = 'Download Clip';
                    downloadContainer.appendChild(downloadLink);
                }
            });
    }
    const statusInterval = setInterval(checkStatus, 5000); // Check every 5 seconds
</script>

{% endblock %}
